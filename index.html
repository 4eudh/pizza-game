<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attack of the Vampire Pizzas! - Enhanced Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Creepster&family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --primary-color: #5D5CDE;
            --secondary-color: #8B5CF6;
            --success-color: #10B981;
            --danger-color: #EF4444;
            --warning-color: #F59E0B;
            --dark-bg: #0A0A0B;
            --dark-surface: #1A1A1D;
            --dark-surface-2: #2D2D30;
        }
        
        .dark {
            --bg-primary: #0A0A0B;
            --bg-secondary: #1A1A1D;
            --bg-surface: #2D2D30;
            --text-primary: #FFFFFF;
            --text-secondary: #A0A0A0;
            --border-color: #3D3D40;
        }
        
        .light {
            --bg-primary: #FFFFFF;
            --bg-secondary: #F8FAFC;
            --bg-surface: #F1F5F9;
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --border-color: #E2E8F0;
        }
        
        * { box-sizing: border-box; }
        
        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        .game-title {
            font-family: 'Creepster', cursive;
            background: linear-gradient(45deg, #8B5CF6, #5D5CDE, #EC4899);
            background-size: 200% 200%;
            animation: gradientShift 3s ease-in-out infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(139, 92, 246, 0.5);
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .glass-button {
            background: rgba(93, 92, 222, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(93, 92, 222, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass-button:hover {
            background: rgba(93, 92, 222, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(93, 92, 222, 0.2);
        }
        
        .asset-placeholder {
            background: linear-gradient(45deg, #6366f1, #8b5cf6);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .asset-placeholder:hover {
            border-color: rgba(255, 255, 255, 0.6);
            background: linear-gradient(45deg, #7c3aed, #a855f7);
        }
        
        .game-canvas {
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="%23374151" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="%231F2937"/><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            border: 3px solid var(--primary-color);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(93, 92, 222, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .floating-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .pulse-glow {
            animation: pulseGlow 2s ease-in-out infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(93, 92, 222, 0.3); }
            50% { box-shadow: 0 0 40px rgba(93, 92, 222, 0.6); }
        }
        
        .screen {
            display: none;
            min-height: 100vh;
        }
        
        .screen.active {
            display: flex;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--bg-surface) 0%, rgba(93, 92, 222, 0.1) 100%);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .leaderboard-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(5px);
        }
        
        .enemy-sprite, .trap-sprite {
            image-rendering: pixelated;
            position: absolute;
            transition: all 0.2s ease;
        }
        
        .particle-effect {
            position: absolute;
            pointer-events: none;
            animation: particleFloat 1s ease-out forwards;
        }
        
        @keyframes particleFloat {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(0.5); opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- Auth Screen -->
    <div id="authScreen" class="screen active flex-col items-center justify-center p-6">
        <div class="text-center mb-12">
            <h1 class="game-title text-6xl md:text-8xl mb-4 floating-animation">
                Attack of the Vampire Pizzas!
            </h1>
            <p class="text-xl text-gray-400 max-w-2xl mx-auto">
                Defend your pizzeria from hordes of vampire pizzas in this epic tower defense game!
            </p>
        </div>
        
        <div class="glass-panel p-8 w-full max-w-md">
            <div id="loginForm" class="space-y-6">
                <h2 class="text-2xl font-bold text-center mb-6">Welcome Back</h2>
                <div>
                    <label class="block text-sm font-medium mb-2">Email</label>
                    <input type="email" id="loginEmail" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-base focus:border-purple-400 focus:outline-none transition-colors">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Password</label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-base focus:border-purple-400 focus:outline-none transition-colors">
                </div>
                <button id="loginBtn" class="w-full glass-button py-3 rounded-lg font-semibold">
                    Sign In
                </button>
                <div class="text-center">
                    <button id="showSignupBtn" class="text-purple-400 hover:text-purple-300 transition-colors">
                        Don't have an account? Sign up
                    </button>
                </div>
                <div class="text-center">
                    <button id="guestBtn" class="text-gray-400 hover:text-gray-300 transition-colors">
                        Continue as Guest
                    </button>
                </div>
            </div>
            
            <div id="signupForm" class="space-y-6 hidden">
                <h2 class="text-2xl font-bold text-center mb-6">Create Account</h2>
                <div>
                    <label class="block text-sm font-medium mb-2">Username</label>
                    <input type="text" id="signupUsername" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-base focus:border-purple-400 focus:outline-none transition-colors">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Email</label>
                    <input type="email" id="signupEmail" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-base focus:border-purple-400 focus:outline-none transition-colors">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Password</label>
                    <input type="password" id="signupPassword" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-base focus:border-purple-400 focus:outline-none transition-colors">
                </div>
                <button id="signupBtn" class="w-full glass-button py-3 rounded-lg font-semibold">
                    Create Account
                </button>
                <div class="text-center">
                    <button id="showLoginBtn" class="text-purple-400 hover:text-purple-300 transition-colors">
                        Already have an account? Sign in
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Menu Screen -->
    <div id="menuScreen" class="screen flex-col items-center justify-center p-6">
        <h1 class="game-title text-5xl md:text-7xl mb-8 floating-animation">
            Attack of the Vampire Pizzas!
        </h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-4xl">
            <button id="playBtn" class="glass-panel p-8 text-center hover:scale-105 transition-transform">
                <div class="text-4xl mb-4">üéÆ</div>
                <h3 class="text-2xl font-bold mb-2">Play Game</h3>
                <p class="text-gray-400">Start defending your pizzeria!</p>
            </button>
            
            <button id="profileBtn" class="glass-panel p-8 text-center hover:scale-105 transition-transform">
                <div class="text-4xl mb-4">üë§</div>
                <h3 class="text-2xl font-bold mb-2">Profile</h3>
                <p class="text-gray-400">View stats and achievements</p>
            </button>
            
            <button id="leaderboardBtn" class="glass-panel p-8 text-center hover:scale-105 transition-transform">
                <div class="text-4xl mb-4">üèÜ</div>
                <h3 class="text-2xl font-bold mb-2">Leaderboard</h3>
                <p class="text-gray-400">See top players worldwide</p>
            </button>
            
            <button id="settingsBtn" class="glass-panel p-8 text-center hover:scale-105 transition-transform">
                <div class="text-4xl mb-4">‚öôÔ∏è</div>
                <h3 class="text-2xl font-bold mb-2">Settings</h3>
                <p class="text-gray-400">Customize your experience</p>
            </button>
        </div>
        
        <div class="mt-8 text-center">
            <div id="userWelcome" class="text-lg mb-4"></div>
            <button id="logoutBtn" class="text-red-400 hover:text-red-300 transition-colors">
                Logout
            </button>
        </div>
    </div>
    
    <!-- Game Screen -->
    <div id="gameScreen" class="screen">
        <div class="flex flex-col lg:flex-row gap-4 p-4 min-h-screen">
            <!-- Main Game Area -->
            <div class="flex-1 flex flex-col">
                <!-- Top UI Bar -->
                <div class="glass-panel p-4 mb-4">
                    <div class="flex items-center justify-between">
                        <button id="backToMenuBtn" class="glass-button px-4 py-2 rounded-lg">
                            ‚Üê Menu
                        </button>
                        <h2 class="game-title text-2xl">Vampire Pizza Defense</h2>
                        <div class="flex gap-2">
                            <button id="pauseBtn" class="glass-button px-4 py-2 rounded-lg">‚è∏Ô∏è</button>
                            <button id="speedBtn" class="glass-button px-4 py-2 rounded-lg">1x</button>
                        </div>
                    </div>
                </div>
                
                <!-- Game Stats -->
                <div class="glass-panel p-4 mb-4">
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                        <div class="stat-card p-3 rounded-lg text-center">
                            <div class="text-2xl font-bold text-yellow-400" id="pizzaBucks">30</div>
                            <div class="text-sm text-gray-400">Pizza Bucks</div>
                        </div>
                        <div class="stat-card p-3 rounded-lg text-center">
                            <div class="text-2xl font-bold text-blue-400" id="wave">1</div>
                            <div class="text-sm text-gray-400">Wave</div>
                        </div>
                        <div class="stat-card p-3 rounded-lg text-center">
                            <div class="text-2xl font-bold text-green-400" id="enemiesKilled">0</div>
                            <div class="text-sm text-gray-400">Killed</div>
                        </div>
                        <div class="stat-card p-3 rounded-lg text-center">
                            <div class="text-2xl font-bold text-red-400" id="lives">3</div>
                            <div class="text-sm text-gray-400">Lives</div>
                        </div>
                        <div class="stat-card p-3 rounded-lg text-center">
                            <div class="text-2xl font-bold text-purple-400" id="score">0</div>
                            <div class="text-sm text-gray-400">Score</div>
                        </div>
                    </div>
                </div>
                
                <!-- Game Canvas with Asset Placeholders -->
                <div class="game-canvas flex-1 relative">
                    <!-- REPLACE THIS: Background Image Placeholder -->
                    <div class="absolute inset-0 asset-placeholder">
                        Replace with:<br>game_background.png<br>(1100x600px)
                    </div>
                    
                    <!-- Game entities will be positioned absolutely here -->
                    <div id="gameEntities" class="absolute inset-0"></div>
                    
                    <!-- REPLACE THIS: Path Overlay -->
                    <div class="absolute top-0 left-0 w-48 h-full asset-placeholder">
                        Replace with:<br>path_texture.png<br>(200x600px)
                    </div>
                </div>
            </div>
            
            <!-- Side Panel -->
            <div class="w-full lg:w-80 space-y-4">
                <!-- Trap Shop -->
                <div class="glass-panel p-4">
                    <h3 class="text-xl font-bold mb-4 text-center text-purple-400">Trap Shop</h3>
                    <div class="grid grid-cols-2 gap-3" id="trapShop">
                        <!-- Trap buttons with asset placeholders -->
                    </div>
                </div>
                
                <!-- Wave Progress -->
                <div class="glass-panel p-4">
                    <h3 class="text-xl font-bold mb-4 text-center text-blue-400">Wave Progress</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between text-sm">
                            <span>Next Wave:</span>
                            <span id="nextWaveTimer" class="text-blue-400">30s</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div id="waveProgress" class="bg-blue-400 h-2 rounded-full transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span>Enemies Left:</span>
                            <span id="enemiesLeft" class="text-red-400">0</span>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="glass-panel p-4">
                    <h3 class="text-xl font-bold mb-4 text-center text-green-400">Actions</h3>
                    <div class="space-y-2">
                        <button id="sellModeBtn" class="w-full glass-button py-2 rounded-lg text-sm">
                            üí∞ Sell Mode
                        </button>
                        <button id="upgradeAllBtn" class="w-full glass-button py-2 rounded-lg text-sm">
                            ‚¨ÜÔ∏è Upgrade All
                        </button>
                    </div>
                </div>
                
                <!-- Achievements -->
                <div class="glass-panel p-4 max-h-64 overflow-y-auto">
                    <h3 class="text-xl font-bold mb-4 text-center text-yellow-400">Recent Achievements</h3>
                    <div id="achievementsList" class="space-y-2"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Profile Screen -->
    <div id="profileScreen" class="screen flex-col p-6">
        <div class="max-w-4xl mx-auto w-full">
            <div class="flex items-center justify-between mb-8">
                <h1 class="text-4xl font-bold">Player Profile</h1>
                <button id="backFromProfileBtn" class="glass-button px-6 py-3 rounded-lg">
                    ‚Üê Back to Menu
                </button>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Player Info -->
                <div class="glass-panel p-6">
                    <h2 class="text-2xl font-bold mb-6">Player Information</h2>
                    <div class="space-y-4">
                        <div class="flex items-center space-x-4">
                            <!-- REPLACE THIS: Avatar Placeholder -->
                            <div class="w-16 h-16 asset-placeholder rounded-full">
                                Avatar<br>64x64px
                            </div>
                            <div>
                                <div class="text-xl font-bold" id="profileUsername">Username</div>
                                <div class="text-gray-400" id="profileEmail">email@example.com</div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mt-6">
                            <div class="stat-card p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-purple-400" id="profileHighScore">0</div>
                                <div class="text-sm text-gray-400">High Score</div>
                            </div>
                            <div class="stat-card p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-blue-400" id="profileMaxWave">0</div>
                                <div class="text-sm text-gray-400">Max Wave</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Achievements -->
                <div class="glass-panel p-6">
                    <h2 class="text-2xl font-bold mb-6">Achievements</h2>
                    <div id="profileAchievements" class="space-y-3 max-h-64 overflow-y-auto">
                        <!-- Achievement items will be populated here -->
                    </div>
                </div>
                
                <!-- Game Statistics -->
                <div class="glass-panel p-6 lg:col-span-2">
                    <h2 class="text-2xl font-bold mb-6">Game Statistics</h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="stat-card p-4 rounded-lg text-center">
                            <div class="text-xl font-bold text-red-400" id="profileTotalKills">0</div>
                            <div class="text-sm text-gray-400">Total Kills</div>
                        </div>
                        <div class="stat-card p-4 rounded-lg text-center">
                            <div class="text-xl font-bold text-green-400" id="profileGamesPlayed">0</div>
                            <div class="text-sm text-gray-400">Games Played</div>
                        </div>
                        <div class="stat-card p-4 rounded-lg text-center">
                            <div class="text-xl font-bold text-yellow-400" id="profileTotalDamage">0</div>
                            <div class="text-sm text-gray-400">Total Damage</div>
                        </div>
                        <div class="stat-card p-4 rounded-lg text-center">
                            <div class="text-xl font-bold text-orange-400" id="profileTrapsBuilt">0</div>
                            <div class="text-sm text-gray-400">Traps Built</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Leaderboard Screen -->
    <div id="leaderboardScreen" class="screen flex-col p-6">
        <div class="max-w-4xl mx-auto w-full">
            <div class="flex items-center justify-between mb-8">
                <h1 class="text-4xl font-bold">Global Leaderboard</h1>
                <button id="backFromLeaderboardBtn" class="glass-button px-6 py-3 rounded-lg">
                    ‚Üê Back to Menu
                </button>
            </div>
            
            <div class="glass-panel p-6">
                <div class="flex justify-center mb-6">
                    <div class="flex space-x-4">
                        <button id="scoreLeaderboard" class="glass-button px-6 py-2 rounded-lg active">
                            High Scores
                        </button>
                        <button id="waveLeaderboard" class="glass-button px-6 py-2 rounded-lg">
                            Max Waves
                        </button>
                    </div>
                </div>
                
                <div id="leaderboardContent" class="space-y-3">
                    <!-- Leaderboard items will be populated here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Game Modals -->
    <div id="pauseModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="glass-panel p-8 max-w-md w-full mx-4">
            <h2 class="text-3xl font-bold text-center mb-6">Game Paused</h2>
            <div class="space-y-4">
                <button id="resumeBtn" class="w-full glass-button py-3 rounded-lg font-semibold">
                    Resume Game
                </button>
                <button id="restartBtn" class="w-full glass-button py-3 rounded-lg font-semibold">
                    Restart Wave
                </button>
                <button id="quitBtn" class="w-full bg-red-500/20 border border-red-500/30 py-3 rounded-lg font-semibold hover:bg-red-500/30 transition-colors">
                    Quit to Menu
                </button>
            </div>
        </div>
    </div>
    
    <div id="gameOverModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="glass-panel p-8 max-w-md w-full mx-4">
            <h2 id="gameOverTitle" class="text-3xl font-bold text-center mb-6">Game Over</h2>
            <div id="finalStats" class="space-y-3 mb-6 text-center">
                <!-- Final stats will be populated -->
            </div>
            <div class="space-y-4">
                <button id="playAgainBtn" class="w-full glass-button py-3 rounded-lg font-semibold">
                    Play Again
                </button>
                <button id="viewStatsBtn" class="w-full glass-button py-3 rounded-lg font-semibold">
                    View Profile
                </button>
                <button id="mainMenuBtn" class="w-full bg-gray-500/20 border border-gray-500/30 py-3 rounded-lg font-semibold hover:bg-gray-500/30 transition-colors">
                    Main Menu
                </button>
            </div>
        </div>
    </div>
    
    <!-- Achievement Notification -->
    <div id="achievementNotification" class="fixed top-4 right-4 glass-panel p-4 z-50 hidden max-w-sm">
        <div class="flex items-center space-x-3">
            <div class="text-3xl">üèÜ</div>
            <div>
                <div class="font-bold text-yellow-400">Achievement Unlocked!</div>
                <div id="achievementText" class="text-sm text-gray-300"></div>
                <div id="achievementReward" class="text-xs text-green-400"></div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // ASSET PLACEHOLDERS - REPLACE THESE EASILY
        // ============================================
        
        const ASSET_PATHS = {
            // Enemy sprites (replace these paths with your actual assets)
            enemies: {
                basic: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><rect width="50" height="50" fill="%23654321"/><text x="25" y="30" text-anchor="middle" fill="white" font-size="10">BASIC</text></svg>',
                fast: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><rect width="50" height="50" fill="%23FF4500"/><text x="25" y="30" text-anchor="middle" fill="white" font-size="10">FAST</text></svg>',
                tank: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><rect width="50" height="50" fill="%232F4F4F"/><text x="25" y="30" text-anchor="middle" fill="white" font-size="10">TANK</text></svg>',
                flying: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><rect width="50" height="50" fill="%234B0082"/><text x="25" y="30" text-anchor="middle" fill="white" font-size="10">FLY</text></svg>',
                boss: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><rect width="50" height="50" fill="%238B0000"/><text x="25" y="30" text-anchor="middle" fill="white" font-size="8">BOSS</text></svg>'
            },
            
            // Trap sprites (replace these paths with your actual assets)
            traps: {
                garlic: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80"><rect width="80" height="80" fill="%23FFFACD" stroke="%23DDD" stroke-width="2"/><text x="40" y="45" text-anchor="middle" fill="black" font-size="12">GARLIC</text></svg>',
                cutter: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80"><rect width="80" height="80" fill="%23C0C0C0" stroke="%23DDD" stroke-width="2"/><text x="40" y="45" text-anchor="middle" fill="black" font-size="11">CUTTER</text></svg>',
                holy_water: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80"><rect width="80" height="80" fill="%2387CEEB" stroke="%23DDD" stroke-width="2"/><text x="40" y="45" text-anchor="middle" fill="black" font-size="10">HOLY H2O</text></svg>',
                mirror: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80"><rect width="80" height="80" fill="%23E6E6FA" stroke="%23DDD" stroke-width="2"/><text x="40" y="45" text-anchor="middle" fill="black" font-size="11">MIRROR</text></svg>',
                stake: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80"><rect width="80" height="80" fill="%238B4513" stroke="%23DDD" stroke-width="2"/><text x="40" y="45" text-anchor="middle" fill="white" font-size="12">STAKE</text></svg>',
                generator: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80"><rect width="80" height="80" fill="%23FFD700" stroke="%23DDD" stroke-width="2"/><text x="40" y="45" text-anchor="middle" fill="black" font-size="10">GENERATOR</text></svg>'
            },
            
            // UI Icons (replace these paths with your actual assets)
            ui: {
                avatar_placeholder: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><circle cx="32" cy="32" r="30" fill="%236366f1"/><text x="32" y="38" text-anchor="middle" fill="white" font-size="24">üë§</text></svg>',
                trophy: 'üèÜ',
                star: '‚≠ê',
                coin: 'ü™ô'
            }
        };
        
        // ============================================
        // GAME CONFIGURATION
        // ============================================
        
        // User management
        let currentUser = null;
        let isGuest = false;
        
        // Supabase configuration (replace with your actual credentials)
        const SUPABASE_URL = 'https://tzbgavzhciqclgmcmoqw.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6YmdhdnpoY2lxY2xnbWNtb3F3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxNzMwNzYsImV4cCI6MjA2ODc0OTA3Nn0.gwjUMYjSLtiI5u5sBTZpg1S9OqVBhKvTZWttuOYPiek';
        
        // Mock Supabase for demo - replace with actual Supabase client
        const supabase = {
            auth: {
                signUp: async (credentials) => {
                    // Mock signup
                    const user = { id: Date.now(), email: credentials.email };
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    return { data: { user }, error: null };
                },
                signInWithPassword: async (credentials) => {
                    // Mock login
                    const user = { id: Date.now(), email: credentials.email };
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    return { data: { user }, error: null };
                },
                signOut: async () => {
                    localStorage.removeItem('currentUser');
                    return { error: null };
                },
                getUser: async () => {
                    const user = localStorage.getItem('currentUser');
                    return { data: { user: user ? JSON.parse(user) : null }, error: null };
                }
            },
            from: (table) => ({
                select: () => ({
                    eq: () => ({
                        single: async () => ({ data: null, error: null })
                    })
                }),
                upsert: async () => ({ data: null, error: null }),
                insert: async () => ({ data: null, error: null })
            })
        };
        
        // Game configuration
        const CONFIG = {
            CANVAS_WIDTH: 1100,
            CANVAS_HEIGHT: 600,
            TILE_SIZE: 100,
            FRAME_RATE: 60,
            BASE_SPAWN_RATE: 120,
            WAVE_DURATION: 1800
        };
        
        // Game state
        let gameState = {
            playing: false,
            paused: false,
            wave: 1,
            pizzaBucks: 30,
            lives: 3,
            score: 0,
            enemiesKilled: 0,
            selectedTrap: null,
            sellMode: false,
            gameSpeed: 1,
            frameCount: 0,
            waveTimer: 0,
            achievements: new Set(),
            stats: {
                totalDamage: 0,
                trapsBuilt: 0,
                moneyEarned: 0,
                wavesCompleted: 0,
                gamesPlayed: 0
            }
        };
        
        // Game entities
        let enemies = [];
        let traps = [];
        let gameEntitiesContainer;
        
        // Trap and enemy definitions (same as before but with asset integration)
        const TRAP_TYPES = {
            garlic: { name: 'Garlic Trap', cost: 15, damage: 10, range: 1, speed: 30, sprite: ASSET_PATHS.traps.garlic },
            cutter: { name: 'Pizza Cutter', cost: 25, damage: 25, range: 1, speed: 45, sprite: ASSET_PATHS.traps.cutter },
            holy_water: { name: 'Holy Water', cost: 40, damage: 15, range: 2, speed: 60, sprite: ASSET_PATHS.traps.holy_water, aoe: true },
            mirror: { name: 'Sacred Mirror', cost: 60, effect: 'slow', range: 1, speed: 30, sprite: ASSET_PATHS.traps.mirror },
            stake: { name: 'Stake Launcher', cost: 80, damage: 50, range: 3, speed: 90, sprite: ASSET_PATHS.traps.stake, piercing: true },
            generator: { name: 'Money Generator', cost: 50, income: 5, sprite: ASSET_PATHS.traps.generator }
        };
        
        const ENEMY_TYPES = {
            basic: { name: 'Vampire Pizza', health: 100, speed: 2, reward: 10, sprite: ASSET_PATHS.enemies.basic, minWave: 1 },
            fast: { name: 'Speed Demon Pizza', health: 60, speed: 4, reward: 15, sprite: ASSET_PATHS.enemies.fast, minWave: 3 },
            tank: { name: 'Armored Pizza', health: 300, speed: 1, reward: 25, sprite: ASSET_PATHS.enemies.tank, minWave: 5 },
            flying: { name: 'Bat Pizza', health: 80, speed: 3, reward: 20, sprite: ASSET_PATHS.enemies.flying, minWave: 7, flying: true },
            boss: { name: 'Pizza Lord', health: 800, speed: 1.5, reward: 100, sprite: ASSET_PATHS.enemies.boss, minWave: 10, boss: true }
        };
        
        const ACHIEVEMENTS = {
            first_kill: { name: 'First Blood', description: 'Kill your first vampire pizza', reward: 10 },
            wave_5: { name: 'Pizza Veteran', description: 'Survive 5 waves', reward: 25 },
            wave_10: { name: 'Pizza Master', description: 'Survive 10 waves', reward: 50 },
            kill_100: { name: 'Vampire Slayer', description: 'Kill 100 vampire pizzas', reward: 100 },
            trap_master: { name: 'Trap Master', description: 'Build 20 traps', reward: 40 }
        };
        
        // ============================================
        // SCREEN MANAGEMENT
        // ============================================
        
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }
        
        // ============================================
        // AUTHENTICATION SYSTEM
        // ============================================
        
        async function initAuth() {
            const { data } = await supabase.auth.getUser();
            if (data.user) {
                currentUser = data.user;
                showMainMenu();
            }
        }
        
        async function handleSignup() {
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const username = document.getElementById('signupUsername').value;
            
            if (!email || !password || !username) {
                showCustomAlert('Please fill in all fields');
                return;
            }
            
            const { data, error } = await supabase.auth.signUp({ email, password });
            
            if (error) {
                showCustomAlert('Error creating account: ' + error.message);
            } else {
                currentUser = data.user;
                await saveUserProfile(username);
                showMainMenu();
            }
        }
        
        async function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showCustomAlert('Please fill in all fields');
                return;
            }
            
            const { data, error } = await supabase.auth.signInWithPassword({ email, password });
            
            if (error) {
                showCustomAlert('Error signing in: ' + error.message);
            } else {
                currentUser = data.user;
                showMainMenu();
            }
        }
        
        function handleGuestLogin() {
            isGuest = true;
            currentUser = { id: 'guest', email: 'guest@example.com' };
            showMainMenu();
        }
        
        async function handleLogout() {
            await supabase.auth.signOut();
            currentUser = null;
            isGuest = false;
            showScreen('authScreen');
        }
        
        function showMainMenu() {
            const username = currentUser?.email?.split('@')[0] || 'Guest';
            document.getElementById('userWelcome').textContent = `Welcome back, ${username}!`;
            showScreen('menuScreen');
            loadUserProfile();
        }
        
        // ============================================
        // CUSTOM MODALS (replacing alert/confirm/prompt)
        // ============================================
        
        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="glass-panel p-6 max-w-sm w-full mx-4">
                    <p class="text-center mb-4">${message}</p>
                    <button onclick="this.closest('.fixed').remove()" 
                            class="w-full glass-button py-2 rounded-lg">OK</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function showCustomConfirm(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="glass-panel p-6 max-w-sm w-full mx-4">
                    <p class="text-center mb-6">${message}</p>
                    <div class="flex space-x-3">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="flex-1 bg-gray-500/20 border border-gray-500/30 py-2 rounded-lg">Cancel</button>
                        <button onclick="this.closest('.fixed').remove(); (${onConfirm.toString()})()" 
                                class="flex-1 glass-button py-2 rounded-lg">Confirm</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // ============================================
        // GAME LOGIC WITH ASSET INTEGRATION
        // ============================================
        
        function initGame() {
            gameEntitiesContainer = document.getElementById('gameEntities');
            initTrapShop();
            startGameLoop();
        }
        
        function initTrapShop() {
            const trapShop = document.getElementById('trapShop');
            trapShop.innerHTML = '';
            
            Object.entries(TRAP_TYPES).forEach(([key, trap]) => {
                const button = document.createElement('button');
                button.className = 'glass-button p-3 rounded-lg text-center transition-all hover:scale-105';
                button.innerHTML = `
                    <img src="${trap.sprite}" alt="${trap.name}" class="w-12 h-12 mx-auto mb-2 rounded">
                    <div class="text-xs font-bold">${trap.name}</div>
                    <div class="text-xs text-yellow-400">$${trap.cost}</div>
                `;
                button.addEventListener('click', () => selectTrap(key));
                button.id = `trap_${key}`;
                trapShop.appendChild(button);
            });
        }
        
        function selectTrap(trapType) {
            if (gameState.pizzaBucks >= TRAP_TYPES[trapType].cost) {
                gameState.selectedTrap = trapType;
                gameState.sellMode = false;
                updateTrapButtons();
            }
        }
        
        function updateTrapButtons() {
            Object.keys(TRAP_TYPES).forEach(key => {
                const button = document.getElementById(`trap_${key}`);
                const trap = TRAP_TYPES[key];
                
                button.classList.remove('ring-2', 'ring-purple-400');
                if (gameState.selectedTrap === key) {
                    button.classList.add('ring-2', 'ring-purple-400');
                }
                
                button.style.opacity = gameState.pizzaBucks >= trap.cost ? '1' : '0.5';
            });
        }
        
        function spawnEnemy() {
            const enemyTypes = Object.entries(ENEMY_TYPES).filter(([key, enemy]) => 
                enemy.minWave <= gameState.wave
            );
            
            if (enemyTypes.length === 0) return;
            
            const [enemyType, enemyTemplate] = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
            
            const enemy = {
                id: Date.now() + Math.random(),
                type: enemyType,
                x: CONFIG.CANVAS_WIDTH,
                y: Math.floor(Math.random() * 5) * 100 + 50,
                health: enemyTemplate.health * (1 + gameState.wave * 0.1),
                maxHealth: enemyTemplate.health * (1 + gameState.wave * 0.1),
                speed: enemyTemplate.speed,
                reward: enemyTemplate.reward,
                sprite: enemyTemplate.sprite,
                boss: enemyTemplate.boss || false,
                element: null
            };
            
            // Create visual element
            const enemyElement = document.createElement('div');
            enemyElement.className = 'enemy-sprite';
            enemyElement.style.cssText = `
                left: ${enemy.x}px;
                top: ${enemy.y}px;
                width: 40px;
                height: 40px;
                z-index: 10;
            `;
            
            const img = document.createElement('img');
            img.src = enemy.sprite;
            img.alt = enemyTemplate.name;
            img.className = 'w-full h-full';
            enemyElement.appendChild(img);
            
            // Health bar
            const healthBar = document.createElement('div');
            healthBar.className = 'absolute -top-2 left-0 w-full h-1 bg-red-500 rounded';
            healthBar.innerHTML = `<div class="h-full bg-green-500 rounded transition-all duration-200" style="width: 100%"></div>`;
            enemyElement.appendChild(healthBar);
            
            enemy.element = enemyElement;
            gameEntitiesContainer.appendChild(enemyElement);
            enemies.push(enemy);
        }
        
        function updateEnemies() {
            enemies.forEach((enemy, index) => {
                enemy.x -= enemy.speed * gameState.gameSpeed;
                
                // Update visual position
                if (enemy.element) {
                    enemy.element.style.left = `${enemy.x}px`;
                    
                    // Update health bar
                    const healthBar = enemy.element.querySelector('.bg-green-500');
                    if (healthBar) {
                        healthBar.style.width = `${(enemy.health / enemy.maxHealth) * 100}%`;
                    }
                }
                
                // Check if reached end
                if (enemy.x < -50) {
                    if (enemy.element) {
                        enemy.element.remove();
                    }
                    enemies.splice(index, 1);
                    gameState.lives--;
                    if (gameState.lives <= 0) {
                        gameOver();
                    }
                    return;
                }
                
                // Check if dead
                if (enemy.health <= 0) {
                    if (enemy.element) {
                        enemy.element.remove();
                    }
                    enemies.splice(index, 1);
                    gameState.pizzaBucks += enemy.reward;
                    gameState.score += enemy.reward * 10;
                    gameState.enemiesKilled++;
                    
                    createDeathEffect(enemy.x, enemy.y);
                    checkAchievements();
                }
            });
        }
        
        function createDeathEffect(x, y) {
            const effect = document.createElement('div');
            effect.className = 'particle-effect text-2xl';
            effect.textContent = 'üí•';
            effect.style.cssText = `
                left: ${x}px;
                top: ${y}px;
                z-index: 20;
            `;
            gameEntitiesContainer.appendChild(effect);
            
            setTimeout(() => effect.remove(), 1000);
        }
        
        function updateGame() {
            if (!gameState.playing || gameState.paused) return;
            
            gameState.frameCount++;
            gameState.waveTimer++;
            
            // Spawn enemies
            if (gameState.frameCount % Math.floor(CONFIG.BASE_SPAWN_RATE / gameState.gameSpeed) === 0) {
                spawnEnemy();
            }
            
            // Update entities
            updateEnemies();
            
            // Update wave
            if (gameState.waveTimer >= CONFIG.WAVE_DURATION) {
                gameState.wave++;
                gameState.waveTimer = 0;
                gameState.stats.wavesCompleted++;
            }
            
            updateUI();
        }
        
        function updateUI() {
            document.getElementById('pizzaBucks').textContent = gameState.pizzaBucks;
            document.getElementById('wave').textContent = gameState.wave;
            document.getElementById('enemiesKilled').textContent = gameState.enemiesKilled;
            document.getElementById('lives').textContent = gameState.lives;
            document.getElementById('score').textContent = gameState.score;
            
            // Wave progress
            const progress = (gameState.waveTimer / CONFIG.WAVE_DURATION) * 100;
            document.getElementById('waveProgress').style.width = `${progress}%`;
            
            const timeLeft = Math.ceil((CONFIG.WAVE_DURATION - gameState.waveTimer) / CONFIG.FRAME_RATE);
            document.getElementById('nextWaveTimer').textContent = `${timeLeft}s`;
            document.getElementById('enemiesLeft').textContent = enemies.length;
            
            updateTrapButtons();
        }
        
        function checkAchievements() {
            Object.entries(ACHIEVEMENTS).forEach(([id, achievement]) => {
                if (gameState.achievements.has(id)) return;
                
                let unlocked = false;
                switch(id) {
                    case 'first_kill':
                        unlocked = gameState.enemiesKilled >= 1;
                        break;
                    case 'wave_5':
                        unlocked = gameState.stats.wavesCompleted >= 5;
                        break;
                    case 'wave_10':
                        unlocked = gameState.stats.wavesCompleted >= 10;
                        break;
                    case 'kill_100':
                        unlocked = gameState.enemiesKilled >= 100;
                        break;
                    case 'trap_master':
                        unlocked = gameState.stats.trapsBuilt >= 20;
                        break;
                }
                
                if (unlocked) {
                    gameState.achievements.add(id);
                    gameState.pizzaBucks += achievement.reward;
                    showAchievementNotification(achievement);
                }
            });
        }
        
        function showAchievementNotification(achievement) {
            const notification = document.getElementById('achievementNotification');
            document.getElementById('achievementText').textContent = achievement.name;
            document.getElementById('achievementReward').textContent = `+${achievement.reward} Pizza Bucks`;
            
            notification.classList.remove('hidden');
            setTimeout(() => notification.classList.add('hidden'), 4000);
        }
        
        function startGameLoop() {
            setInterval(updateGame, 1000 / CONFIG.FRAME_RATE);
        }
        
        function startGame() {
            gameState.playing = true;
            gameState.paused = false;
            gameState.stats.gamesPlayed++;
            showScreen('gameScreen');
        }
        
        function pauseGame() {
            gameState.paused = !gameState.paused;
            document.getElementById('pauseModal').classList.toggle('hidden', !gameState.paused);
        }
        
        function gameOver() {
            gameState.playing = false;
            
            document.getElementById('gameOverTitle').textContent = 'Game Over!';
            document.getElementById('finalStats').innerHTML = `
                <div class="text-lg">Final Score: <span class="text-purple-400">${gameState.score}</span></div>
                <div>Wave Reached: <span class="text-blue-400">${gameState.wave}</span></div>
                <div>Enemies Killed: <span class="text-red-400">${gameState.enemiesKilled}</span></div>
            `;
            
            document.getElementById('gameOverModal').classList.remove('hidden');
            saveGameData();
        }
        
        // ============================================
        // PROFILE AND LEADERBOARD
        // ============================================
        
        async function loadUserProfile() {
            if (!currentUser) return;
            
            document.getElementById('profileUsername').textContent = currentUser.email?.split('@')[0] || 'Guest';
            document.getElementById('profileEmail').textContent = currentUser.email || 'guest@example.com';
            
            // Load stats from localStorage for demo
            const savedStats = localStorage.getItem(`userStats_${currentUser.id}`);
            if (savedStats) {
                const stats = JSON.parse(savedStats);
                document.getElementById('profileHighScore').textContent = stats.highScore || 0;
                document.getElementById('profileMaxWave').textContent = stats.maxWave || 0;
                document.getElementById('profileTotalKills').textContent = stats.totalKills || 0;
                document.getElementById('profileGamesPlayed').textContent = stats.gamesPlayed || 0;
                document.getElementById('profileTotalDamage').textContent = stats.totalDamage || 0;
                document.getElementById('profileTrapsBuilt').textContent = stats.trapsBuilt || 0;
            }
        }
        
        async function saveGameData() {
            if (!currentUser) return;
            
            const currentStats = JSON.parse(localStorage.getItem(`userStats_${currentUser.id}`) || '{}');
            
            const newStats = {
                highScore: Math.max(currentStats.highScore || 0, gameState.score),
                maxWave: Math.max(currentStats.maxWave || 0, gameState.wave),
                totalKills: (currentStats.totalKills || 0) + gameState.enemiesKilled,
                gamesPlayed: (currentStats.gamesPlayed || 0) + 1,
                totalDamage: (currentStats.totalDamage || 0) + gameState.stats.totalDamage,
                trapsBuilt: (currentStats.trapsBuilt || 0) + gameState.stats.trapsBuilt
            };
            
            localStorage.setItem(`userStats_${currentUser.id}`, JSON.stringify(newStats));
        }
        
        function loadLeaderboard() {
            const leaderboardContent = document.getElementById('leaderboardContent');
            leaderboardContent.innerHTML = '';
            
            // Mock leaderboard data
            const mockData = [
                { username: 'PizzaMaster2024', score: 125000, wave: 25 },
                { username: 'VampireSlayer', score: 98000, wave: 22 },
                { username: 'GarlicGuru', score: 87500, wave: 19 },
                { username: 'DefenseKing', score: 76200, wave: 17 },
                { username: 'TrapLord', score: 65400, wave: 15 }
            ];
            
            mockData.forEach((player, index) => {
                const item = document.createElement('div');
                item.className = 'leaderboard-item p-4 rounded-lg flex items-center justify-between';
                item.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <div class="text-2xl font-bold text-yellow-400">#${index + 1}</div>
                        <div>
                            <div class="font-semibold">${player.username}</div>
                            <div class="text-sm text-gray-400">Wave ${player.wave}</div>
                        </div>
                    </div>
                    <div class="text-lg font-bold text-purple-400">${player.score.toLocaleString()}</div>
                `;
                leaderboardContent.appendChild(item);
            });
        }
        
        // ============================================
        // EVENT LISTENERS
        // ============================================
        
        function setupEventListeners() {
            // Auth screen
            document.getElementById('showSignupBtn').addEventListener('click', () => {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('signupForm').classList.remove('hidden');
            });
            
            document.getElementById('showLoginBtn').addEventListener('click', () => {
                document.getElementById('signupForm').classList.add('hidden');
                document.getElementById('loginForm').classList.remove('hidden');
            });
            
            document.getElementById('loginBtn').addEventListener('click', handleLogin);
            document.getElementById('signupBtn').addEventListener('click', handleSignup);
            document.getElementById('guestBtn').addEventListener('click', handleGuestLogin);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Menu screen
            document.getElementById('playBtn').addEventListener('click', startGame);
            document.getElementById('profileBtn').addEventListener('click', () => {
                loadUserProfile();
                showScreen('profileScreen');
            });
            document.getElementById('leaderboardBtn').addEventListener('click', () => {
                loadLeaderboard();
                showScreen('leaderboardScreen');
            });
            
            // Game screen
            document.getElementById('backToMenuBtn').addEventListener('click', () => showScreen('menuScreen'));
            document.getElementById('pauseBtn').addEventListener('click', pauseGame);
            document.getElementById('speedBtn').addEventListener('click', () => {
                gameState.gameSpeed = gameState.gameSpeed === 4 ? 1 : gameState.gameSpeed + 1;
                document.getElementById('speedBtn').textContent = `${gameState.gameSpeed}x`;
            });
            
            // Modal buttons
            document.getElementById('resumeBtn').addEventListener('click', pauseGame);
            document.getElementById('restartBtn').addEventListener('click', () => {
                // Reset game state
                gameState = {
                    playing: true, paused: false, wave: 1, pizzaBucks: 30, lives: 3, score: 0,
                    enemiesKilled: 0, selectedTrap: null, sellMode: false, gameSpeed: 1,
                    frameCount: 0, waveTimer: 0, achievements: new Set(),
                    stats: { totalDamage: 0, trapsBuilt: 0, moneyEarned: 0, wavesCompleted: 0, gamesPlayed: 0 }
                };
                enemies.forEach(enemy => enemy.element?.remove());
                enemies = [];
                traps = [];
                document.getElementById('pauseModal').classList.add('hidden');
            });
            
            document.getElementById('quitBtn').addEventListener('click', () => {
                document.getElementById('pauseModal').classList.add('hidden');
                showScreen('menuScreen');
            });
            
            document.getElementById('playAgainBtn').addEventListener('click', () => {
                document.getElementById('gameOverModal').classList.add('hidden');
                startGame();
            });
            
            document.getElementById('mainMenuBtn').addEventListener('click', () => {
                document.getElementById('gameOverModal').classList.add('hidden');
                showScreen('menuScreen');
            });
            
            // Navigation buttons
            document.getElementById('backFromProfileBtn').addEventListener('click', () => showScreen('menuScreen'));
            document.getElementById('backFromLeaderboardBtn').addEventListener('click', () => showScreen('menuScreen'));
        }
        
        async function saveUserProfile(username) {
            // Mock save - replace with actual Supabase call
            const profile = { username, created_at: new Date().toISOString() };
            localStorage.setItem(`userProfile_${currentUser.id}`, JSON.stringify(profile));
        }
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        function initDarkMode() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.add('light');
            }
            
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                document.documentElement.classList.remove('dark', 'light');
                document.documentElement.classList.add(event.matches ? 'dark' : 'light');
            });
        }
        
        // Initialize everything when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            initDarkMode();
            setupEventListeners();
            initAuth();
            initGame();
        });
    </script>
</body>
</html>
